<!--
     __                            .-'''-.               
...-'  |`. ..-'''-.               '   _    \             
|      |  |\.-'''\ \   /|       /   /` '.   \ /|         
....   |  |       | |  ||      .   |     \  ' ||         
  -|   |  |    __/ /   ||      |   '      |  '||         
   |   |  |   |_  '.   ||  __  \    \     / / ||  __     
...'   `--'      `.  \ ||/'__ '.`.   ` ..' /  ||/'__ '.  
|         |`.      \ '.|:/`  '. '  '-...-'`   |:/`  '. ' 
` --------\ |       , |||     | |             ||     | | 
 `---------'        | |||\    / '             ||\    / ' 
                   / ,'|/\'..' /              |/\'..' /  
           -....--'  / '  `'-'`               '  `'-'`   
           `.. __..-'                                    
-->
<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="description" content="Menu">
		<link rel="icon" href="//13bob.net/world.gif">
		<title>13bob</title>
		<style> html { background-color: black; overflow: hidden; } canvas { width: 100%; height: 100%; position: center; } </style>
	</head>
	<body>
		<script src="three.js"></script>
		<script>
			//var audio = new Audio("Shawn Kemp - softwehr - 04 clinics.flac");
			//audio.play();

			function cubeObj(mesh, x, y, z, vX, vY, vZ) {
				var ret = {};
				ret.mesh = mesh;
				ret.x = x;
				ret.y = y;
				ret.z = z;
				ret.vX = vX;
				ret.vY = vY;
				ret.vZ = vZ;
				return ret;
			} cubes = [];

			var scene = new THREE.Scene();
			var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);

			var renderer = new THREE.WebGLRenderer({ antialias: true });
			renderer.setPixelRatio(window.devicePixelRatio);
			renderer.setSize(window.innerWidth * 0.995, window.innerHeight * 0.99);
			renderer.shadowMap.enabled = true;
			renderer.shadowMap.type = THREE.PCFSoftShadowMap;
			document.body.appendChild(renderer.domElement);
			window.addEventListener('resize', onWindowResize, false);

			camera.position.z = 20; // Push back camera

			function onWindowResize() {
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize(window.innerWidth, window.innerHeight);
			}

			function addCube(x, y, z, vX, vY, vZ, col) {
				var geometry = new THREE.BoxGeometry(x, y, z);
				var material = new THREE.MeshBasicMaterial({ color: col });
				var cube = new THREE.Mesh(geometry, material);
				cube.castShadow = true;
				cube.receiveShadow = true;
				cubes.push(new cubeObj(cube, x, y, z, vX, vY, vZ));
				scene.add(cubes[cubes.length-1].mesh);
			}

			function letThereBeLight() {
				light = new THREE.PointLight(0xffffff, 1.5, 100);
				light.position.set(0, 0, 10);
				light.castShadow = true;
				light.shadow.mapSize.width = 1024;
				light.shadow.mapSize.height = 1024;
				light.shadow.camera.near = 0.5;
				light.shadow.camera.far = camera.far;
				light.showCameraVisible = true;
				light.shadow.bias = -0.005; // Reduces self-shadowing on double-sided objects
				scene.add(light);
			}

			letThereBeLight();

			var plane = new THREE.Mesh(new THREE.PlaneGeometry(25, 25), new THREE.MeshStandardMaterial( {color: 0xff0000} ));
			plane.castShadow = false;
			plane.receiveShadow = true;
			plane.position.set(0, 0, -15);
			scene.add(plane);
			addCube(0, 0, 0, 0.1, 0.2, 0.3, 0x00ff00);

			var dX, dY, dZ, lX;

			function animate() {
				requestAnimationFrame(animate);

				camera.lookAt(new THREE.Vector3(cubes[0].mesh.position.x, cubes[0].mesh.position.y, cubes[0].mesh.position.z));

				if (light.intensity < 0 || light.intensity > 2) lX = !lX;
				light.intensity += lX ? 0.005 : -0.005;

				for (var i = 0; i < cubes.length; i++) {
					if (cubes[i].mesh.position.x < -8 || cubes[i].mesh.position.x > 8) dX = !dX;
					if (cubes[i].mesh.position.y < -8 || cubes[i].mesh.position.y > 8) dY = !dY;
					if (cubes[i].mesh.position.z < -8 || cubes[i].mesh.position.z > 8) dZ = !dZ;

					cubes[i].mesh.position.x += dX ? cubes[i].vX / 10 : -cubes[i].vX / 10;
					cubes[i].mesh.position.y += dY ? cubes[i].vY / 10 : -cubes[i].vY / 10;
					cubes[i].mesh.position.z += dZ ? cubes[i].vZ / 10 : -cubes[i].vZ / 10;

					cubes[i].mesh.rotation.x += cubes[i].vX / 100;
					cubes[i].mesh.rotation.y += cubes[i].vY / 100;
					cubes[i].mesh.rotation.z += cubes[i].vZ / 100;
				}
				renderer.render(scene, camera);
			}
			animate();
		</script>
	</body>
</html>
