<!--
     __                            .-'''-.               
...-'  |`. ..-'''-.               '   _    \             
|      |  |\.-'''\ \   /|       /   /` '.   \ /|         
....   |  |       | |  ||      .   |     \  ' ||         
  -|   |  |    __/ /   ||      |   '      |  '||         
   |   |  |   |_  '.   ||  __  \    \     / / ||  __     
...'   `--'      `.  \ ||/'__ '.`.   ` ..' /  ||/'__ '.  
|         |`.      \ '.|:/`  '. '  '-...-'`   |:/`  '. ' 
` --------\ |       , |||     | |             ||     | | 
 `---------'        | |||\    / '             ||\    / ' 
                   / ,'|/\'..' /              |/\'..' /  
           -....--'  / '  `'-'`               '  `'-'`   
           `.. __..-'                                    
-->
<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="description" content="Menu">
		<link rel="icon" href="//13bob.net/world.gif">
		<title>13bob</title>
		<style> html { background-color: black; overflow: hidden; } canvas { width: 100%; height: 100%; position: center; } </style>
	</head>
	<body>
		<script src="three.js"></script>
		<script>
			var audio = new Audio("01 - Strawberry Switchblade - Since Yesterday.mp3"),
			scene, camera, renderer,
			xAxis = new THREE.Vector3(1, 0, 0),
			yAxis = new THREE.Vector3(0, 1, 0),
			zAxis = new THREE.Vector3(0, 0, 1),
			clock = new THREE.Clock(),
			clip, mixer, clipAction, duration = 177, clips = [],
			cameraLook = false,
			objects = [], lights = [];

			function object(mesh, type, texture, cShadow, rShadow, keyFrames, sequences) {
				var ret = {};
				ret.mesh = mesh;
				ret.type = type;
				ret.texture = texture;
				ret.cShadow = cShadow;
				ret.rShadow = rShadow;
				ret.sequences = sequences;
				return ret;
			}

			function onWindowResize() {
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize(window.innerWidth, window.innerHeight);
			}

			function addObj(radius, type, tex, cShadow, rShadow, sequences) {
				switch(type) {
					case 0: // Sphere
						var texture = new THREE.Texture(tex);
						var material = new THREE.MeshPhongMaterial( { map: THREE.ImageUtils.loadTexture(tex, THREE.SphericalRefractionMapping) } );
						//material.wireframe = true;
						var mesh = new THREE.Mesh(new THREE.SphereGeometry(radius, 100, 100), material);
						objects.push(new object(mesh, type, tex, cShadow, rShadow, sequences));
						mesh.castShadow = objects[objects.length-1].cShadow;
						mesh.receiveShadow = objects[objects.length-1].rShadow;
						scene.add(objects[objects.length-1].mesh);

						clip = new THREE.AnimationClip(tex.substring(0, objects[objects.length-1].length-4), duration, sequences);
						mixer = new THREE.AnimationMixer(objects[objects.length-1].mesh);
						clipAction = mixer.clipAction(clip);
						clips.push(clipAction);
					break;
					case 1: // Light

					break;
				}
			}

			function addSkybox() {
				var materialArray = [];
				materialArray.push(new THREE.MeshBasicMaterial( { map: THREE.ImageUtils.loadTexture('img/skybox/xpos.png') }));
				materialArray.push(new THREE.MeshBasicMaterial( { map: THREE.ImageUtils.loadTexture('img/skybox/xneg.png') }));
				materialArray.push(new THREE.MeshBasicMaterial( { map: THREE.ImageUtils.loadTexture('img/skybox/ypos.png') }));
				materialArray.push(new THREE.MeshBasicMaterial( { map: THREE.ImageUtils.loadTexture('img/skybox/yneg.png') }));
				materialArray.push(new THREE.MeshBasicMaterial( { map: THREE.ImageUtils.loadTexture('img/skybox/zpos.png') }));
				materialArray.push(new THREE.MeshBasicMaterial( { map: THREE.ImageUtils.loadTexture('img/skybox/zneg.png') }));
				for (var i = 0; i < 6; i++) materialArray[i].side = THREE.BackSide;
				var skyboxMaterial = new THREE.MeshFaceMaterial(materialArray);
				var skyboxGeom = new THREE.CubeGeometry(4096, 4096, 4096, 1, 1, 1);
				var skybox = new THREE.Mesh( skyboxGeom, skyboxMaterial );
				scene.add(skybox);
			}

			function addLight() {
				light = new THREE.PointLight(0xffffff, 1, 100);
				light.position.set(0, 0, 0);
				light.castShadow = true;
				light.shadow.mapSize.width = 1024;
				light.shadow.mapSize.height = 1024;
				light.shadow.camera.near = 0.5;
				light.shadow.camera.far = camera.far;
				light.showCameraVisible = true;
				light.shadow.bias = -0.005; // Reduces self-shadowing on double-sided objects
				lights.push(light);
				scene.add(light);
			}

			function init() {
				scene = new THREE.Scene();
				camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 5000);

				renderer = new THREE.WebGLRenderer({ antialias: true });
				renderer.setPixelRatio(window.devicePixelRatio);
				renderer.setSize(window.innerWidth * 0.995, window.innerHeight * 0.99);
				renderer.shadowMap.enabled = true;
				renderer.shadowMap.type = THREE.PCFSoftShadowMap;
				document.body.appendChild(renderer.domElement);
				window.addEventListener('resize', onWindowResize, false);

				camera.position.set(10, 5, 20); // Angle camera

				var axesHelper = new THREE.AxesHelper(10);
				scene.add(axesHelper);

				var ambient = new THREE.AmbientLight(0xffffff);
				scene.add(ambient);

				addSkybox();
				addLight();

				var skybox = new THREE.Mesh(new THREE.SphereGeometry());

				var plane = new THREE.Mesh(new THREE.PlaneGeometry(25, 25), new THREE.MeshStandardMaterial( {color: 0xff0000} ));
				plane.castShadow = false;
				plane.receiveShadow = true;
				plane.position.set(0, 0, -15);
				scene.add(plane);

				var qInitial = new THREE.Quaternion().setFromAxisAngle(yAxis, 0);
				var qFinal = new THREE.Quaternion().setFromAxisAngle(yAxis, Math.PI / 2);

				addObj(3, 0, "earth.jpg", false, false, [new THREE.QuaternionKeyframeTrack('.quaternion', [0, 16], [qInitial.x, qInitial.y, qInitial.z, qInitial.w, qFinal.x, qFinal.y, qFinal.z, qFinal.w])]); // 4 keyFrames 4 values
				addLight()

				// first beat: 0.7
				// second: 2.67
				// 16 seconds to get to vocals.

				for (var c = 0; c < clips.length; c++) clips[c].play();
			}

			function render() {
				var delta = clock.getDelta();

				if (mixer) {
					mixer.update(delta);
				}

				objects[0].mesh.add(camera);
				camera.position.set(0, 0, 13);

				if (cameraLook) camera.lookAt(new THREE.Vector3(objects[0].mesh.position.x, objects[0].mesh.position.y, objects[0].mesh.position.z));
			}

			init();

			function anim() {
				requestAnimationFrame(anim);
				renderer.render(scene, camera);
				render();
			}
			anim();
			audio.play();
			audio.volume = 0.3;
		</script>
	</body>
</html>
